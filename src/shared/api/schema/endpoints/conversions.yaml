getAllConversions:
  summary: Get all conversions
  operationId: getAllConversions
  tags:
    - Conversions
  parameters:
    - name: aasm_state
      in: query
      required: false
      schema:
        type: string
        enum: [register, sell, rebill, cancel]
    - name: convertible_type
      in: query
      required: false
      schema:
        type: string
        enum: [Click, PromoCode]
    - name: convertible_id
      in: query
      required: false
      schema:
        type: integer
    - name: min_cost
      in: query
      required: false
      schema:
        type: number
    - name: max_cost
      in: query
      required: false
      schema:
        type: number
    - name: high_value
      in: query
      required: false
      schema:
        type: boolean
    - name: email
      in: query
      required: false
      schema:
        type: string
    - name: name
      in: query
      required: false
      schema:
        type: string
    - name: date_from
      in: query
      required: false
      schema:
        type: string
        format: date
    - name: date_to
      in: query
      required: false
      schema:
        type: string
        format: date
    - name: _order
      in: query
      required: false
      schema:
        type: string
        description: Field to sort by with optional direction prefix. Use field name for ascending (e.g., 'created_at') or prefix with '-' for descending (e.g., '-cost')
        examples:
          - 'created_at'
          - '-cost'
          - 'email'
          - '-revenue'
    - name: page
      in: query
      required: false
      schema:
        type: integer
        description: Page number for pagination
    - name: limit
      in: query
      required: false
      schema:
        type: integer
        description: Number of items per page
  responses:
    "200":
      description: A list of conversions
      content:
        application/json:
          schema:
            type: object
            properties:
              conversions:
                type: array
                items:
                  $ref: "#/components/schemas/ConversionRecord"
              pagination:
                $ref: "../shared/responses.yaml#/schemas/Pagination"
              stats:
                type: object
                properties:
                  total_count:
                    type: integer
                  total_cost:
                    type: number
                    format: float
                  total_revenue:
                    type: number
                    format: float
                  by_state:
                    type: object
                  by_type:
                    type: object
                  high_value_count:
                    type: integer
              sorting:
                type: object
                properties:
                  field:
                    type: string
                    nullable: true
                  direction:
                    type: string
                    enum: [asc, desc]
                  order_param:
                    type: string
                    nullable: true
    "401":
      $ref: "../shared/responses.yaml#/UnauthorizedError"

components:
  schemas:
    ConversionRecord:
      type: object
      properties:
        id:
          type: integer
        aasm_state:
          type: string
          enum: [register, sell, rebill, cancel]
        cost:
          type: number
          format: float
        convertible_type:
          type: string
          enum: [Click, PromoCode]
        convertible_id:
          type: integer
        first_name:
          type: string
        last_name:
          type: string
        email:
          type: string
        phone:
          type: string
          nullable: true
        full_name:
          type: string
        convertible_info:
          type: object
        buyer_id:
          type: string
          nullable: true
        offer_name:
          type: string
          nullable: true
        # Click-specific fields (only present when convertible_type is Click)
        click_subid:
          type: string
          nullable: true
        click_country:
          type: string
          nullable: true
        click_city:
          type: string
          nullable: true
        click_ad_campaign_id:
          type: string
          nullable: true
        click_creative_id:
          type: string
          nullable: true
        click_offer_type:
          type: string
          nullable: true
        click_os:
          type: string
          nullable: true
        click_source:
          type: string
          nullable: true
        # PromoCode-specific fields (only present when convertible_type is PromoCode)
        promo_code_name:
          type: string
          nullable: true
        promo_code_discount:
          type: number
          format: float
          nullable: true
        promo_code_expires_at:
          type: string
          format: date
          nullable: true
        promo_code_offer_type:
          type: string
          nullable: true
        # Common fields
        offer_id:
          type: string
        time_to_sell:
          type: number
          format: float
          nullable: true
        time_to_rebill:
          type: number
          format: float
          nullable: true
        revenue:
          type: number
          format: float
          nullable: true
        is_high_value:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time 